"use strict";(self.webpackChunkSHEIN_W=self.webpackChunkSHEIN_W||[]).push([[48209],{748209:function(e,t,n){n.d(t,{zQ:function(){return _e},Zh:function(){return Oe},JB:function(){return Me},p:function(){return ke},Fr:function(){return V},Xy:function(){return oe},Mi:function(){return Ae},dm:function(){return Te}});var s=n(841392),i=n(307317),r=n(665640),o=Object.defineProperty,a=(e,t,n)=>(((e,t,n)=>{t in e?o(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n),n);const l=e=>{var t;return"undefined"==typeof window?null:{container:e.scrollContainer?e.scrollContainer instanceof HTMLElement?e.scrollContainer:document.querySelector(e.scrollContainer):window,key:[null==(t=e.mask)?void 0:t.map((e=>parseFloat(String(e)))).join(""),e.delay,e.exposeRatio,e.observeHide?"obHide":""].join("")}},c={cache:new Map,get(e){const t=(this.cache.get(e.container)||[]).find((t=>t.key==e.key));return t?t.instance:null},set(e){const t=this.cache.get(e.container)||[];t.find((t=>t.key==e.key))||(t.push({key:e.key,instance:e.instance}),this.cache.set(e.container,t))},del(e){if(e.key){const t=this.cache.get(e.container)||[],n=t.findIndex((t=>t.key==e.key));t.splice(n,1),t.length?this.cache.set(e.container,t):this.cache.delete(e.container)}else this.cache.delete(e.container)}},d={IDKEY:"da-eid",REPEATKEY:"da-rid"},u=e=>{if("undefined"==typeof window||!e)return"";if("string"==typeof e)return e;if(e instanceof HTMLElement){const t=e.getAttribute(d.IDKEY);return`[${d.IDKEY}=${t}]`}if((0,s.G)(e))return e.target instanceof HTMLElement?{code:(null==e?void 0:e.code)||"",target:u(e.target)}:e;if(e.length){const t=e[0].classList;return Array.prototype.map.call(t,(e=>`.${e}`)).join("")}return""},h=e=>"undefined"!=typeof window&&e?e instanceof HTMLElement?[e]:"string"==typeof e?Array.prototype.slice.call(document.querySelectorAll(e)):(0,s.G)(e)?h(e.target):e.length?Array.prototype.slice.call(e):[e]:[],p=()=>Number(Math.random().toString().substr(3,3)+Date.now()).toString(36),g=(e,t)=>{let n;switch(e){case"error":n=r.error;break;case"warn":n=r.warn;break;default:n=r.info}"undefined"!=typeof window&&n(t)},b=e=>{if(!e)return{};const{top:t=0,bottom:n=0,right:s=0,left:i=0}=e.getBoundingClientRect&&e.getBoundingClientRect()||{};return{top:t,bottom:n,right:s,left:i,height:e.offsetHeight||e.innerHeight,width:e.offsetWidth||e.innerWidth}},f=(e,t)=>{if(!e||!t)return!1;let n=e,i=t,r=0;const o=[0,0,0,0];if((0,s.G)(e)&&(n=e.el,r=e.ratio||0),(0,s.G)(t)&&(i=t.el,t.mask&&Array.isArray(t.mask)&&t.mask.filter(((e,t)=>{o[t]=parseInt(String(e))}))),!n||!i)return!1;const{top:a=0,left:l=0,right:c=0,bottom:d=0,width:u=0,height:h=0}=b(n);if(0==u||0==h)return!1;const{top:p=0,left:g=0,width:f=0,height:m=0}=b(i),v=f+g-o[1],w=p+m-o[2],y=p+o[0],E=g+o[3];return!(a>=w-h*r||d<=y+h*r||c<=E+u*r||l>=v-u*r)},{IDKEY:m}=d;class v{constructor(e,t){a(this,"initParams"),a(this,"intersectionObFn"),a(this,"listenerEvent"),a(this,"scrollProgress",-1),a(this,"scrollCbFn",[]),a(this,"listenAddScroll",new Map),a(this,"listenMap",new Map),a(this,"scrollContainer"),"undefined"!=typeof window&&((null==t?void 0:t.fromExpose)&&g("info","scroll event from expose❗️"),this.initParams=t,this.intersectionObFn=e,this.scrollContainer=(null==t?void 0:t.scrollContainer)?h(null==t?void 0:t.scrollContainer)[0]:window,this.init())}init(){var e;this.listenerEvent=this.createListener(this.handelScrollEvent).bind(this),null==(e=this.scrollContainer)||e.addEventListener("scroll",this.listenerEvent,!1)}createListener(e,t){return void 0===e?()=>{}:t&&t>0?(0,i.n)({func:e,wait:t,options:{trailing:!1}}):e}handelScrollEvent(e){this.listenScroll(e),"function"==typeof this.intersectionObFn&&this.listenMap.size&&this.listenerEl()}listenerEl(){var e;const t=[];this.listenMap.forEach((e=>{const n=this._withInArea(e.target);e.isIntersecting!==n&&(this.listenMap.set(e.id,Object.assign(e,{isIntersecting:n})),t.push({isIntersecting:n,target:e.target}))})),t.length&&(null==(e=this.intersectionObFn)||e.call(this,t))}_withInArea(e){var t,n;return f({el:e,ratio:(null==(t=this.initParams)?void 0:t.exposeRatio)||0},{el:this.scrollContainer||window,mask:(null==(n=this.initParams)?void 0:n.mask)||[0,0,0,0]})}listenScroll(e){if(!this.scrollCbFn.length)return;const t=this.scrollContainer===window?Math.abs(b(document.body).top||0):this.scrollContainer.scrollTop||0,n=t-this.scrollProgress;if(0===n)return;const s={scrollTop:t,type:n>0?"down":"up"};this.scrollProgress=t,this.scrollCbFn.forEach((t=>t(s,e)))}listen(e,t){if("function"==typeof e){const n=p(),s=this.createListener(e,null==t?void 0:t.delay);return this.listenAddScroll.set(n,s),this.scrollCbFn.push(s),n}}unListen(e){if(e&&this.listenAddScroll.has(e)){this.listenAddScroll.delete(e);const t=[];this.listenAddScroll.forEach((e=>{t.push(e)})),this.scrollCbFn=t}}observe(e){if(!e)return;let t=e.getAttribute(m);t&&this.listenMap.has(t)||(t||(t=p(),e.setAttribute(m,t)),this.listenMap.set(t,{id:t,isIntersecting:!1,target:e}))}unobserve(e){if(!e)return;const t=e.getAttribute(m);t&&this.listenMap.delete(t)}disconnect(){var e;this.listenerEvent&&(null==(e=this.scrollContainer)||e.removeEventListener("scroll",this.listenerEvent,!1))}}class w{constructor(e,t){a(this,"evt",null),a(this,"initOption"),a(this,"handleExposeEvent",[]),a(this,"scrollContainer"),a(this,"io",null),this.initOption=e||null,"undefined"!=typeof window&&(this.scrollContainer=(null==e?void 0:e.scrollContainer)?h(null==e?void 0:e.scrollContainer)[0]:null,this.init(t))}init(e){var t,n,s,i,r;if(this.evt=((e,t)=>{if("function"==typeof window.CustomEvent)return new CustomEvent(e,t);t=t||{bubbles:!1,cancelable:!1,detail:null};const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n})("scroll",{bubbles:!1,cancelable:!1}),window.hasOwnProperty("IntersectionObserver")){const i=(null==(n=null==(t=this.initOption)?void 0:t.mask)?void 0:n.map((e=>-(parseInt(String(e))||0)+"px")).join(" "))||"0px 0px 0px 0px";this.io=new IntersectionObserver(e,{root:this.scrollContainer||null,rootMargin:i,threshold:[(null==(s=this.initOption)?void 0:s.exposeRatio)||0]}),this.scrollContainer=this.scrollContainer||window}else{const t=this.scrollContainer||window;this.scrollContainer=t,this.io=new v(e,{scrollContainer:t,exposeRatio:(null==(i=this.initOption)?void 0:i.exposeRatio)||0,mask:null==(r=this.initOption)?void 0:r.mask})}}triggerScroll(){(0,i.n)({func:()=>{var e;null==(e=this.scrollContainer)||e.dispatchEvent(this.evt)},wait:300,options:{trailing:!1}})}destroy(){var e;null==(e=this.io)||e.disconnect()}}const{IDKEY:y,REPEATKEY:E}=d;class x{constructor(e){a(this,"hasBeenExposeId",new Map),a(this,"initParams"),a(this,"scrollInstance",null),a(this,"singleBlockObMap",new Map),a(this,"intersectionIoMap",new Map),a(this,"intersectionTempExpose",new Set),a(this,"timer"),a(this,"logFn",(()=>{})),this.initParams=e,void 0!==typeof window&&this.init(e)}init(e){this.scrollInstance=new w({scrollContainer:null==e?void 0:e.scrollContainer,exposeRatio:null==e?void 0:e.exposeRatio,delay:null==e?void 0:e.delay,mask:null==e?void 0:e.mask},this.intersectionObserverCallback.bind(this)),this.logFn=(null==e?void 0:e.log)?g:()=>{}}intersectionObserverCallback(e){e.forEach((e=>{var t;const n=e.target;if(e.isIntersecting){const{delay:e=1e3}=this.initParams||{};this.intersectionTempExpose.add(n),clearTimeout(this.timer),this.timer=setTimeout((()=>{this.intersectionPreExpose([...this.intersectionTempExpose]),this.intersectionTempExpose.clear()}),e)}else(null==(t=this.initParams)?void 0:t.observeHide)&&this.sendHideEvent(n)}))}intersectionPreExpose(e){if(!e.length)return;const t={};e.forEach((e=>{if(!this._withInArea(e))return;const n=e.getAttribute(y),s=this.intersectionIoMap.get(n);s&&(t[s.code]||(t[s.code]={info:s,exposeDoms:[]}),t[s.code].exposeDoms.push(e))}));for(const e in t){const n=t[e];n.exposeDoms.length&&this.sendExposeEvent(n.info,n.exposeDoms)}}sendHideEvent(e){if(!e)return;const t=e.getAttribute(y),n=this.intersectionIoMap.get(t);if(!n)return;const{code:s,handle:i}=n;i({code:s,exposeDoms:[],hideDoms:[e]})}sendExposeEvent(e,t){const{code:n,once:s,handle:i,middleJudge:r}=e,o=t.filter((e=>{const t=this.hasBeenExposeId.get(n)||new Set,i=e.getAttribute(y)||"",o=e.getAttribute(E)||"",a=o?t.has(o):t.has(i);if(a)s&&this.removeElements([e]);else{if("function"==typeof r&&!r(e,n))return!1;s&&(t.add(i),o&&t.add(o),this.hasBeenExposeId.set(n,t),this.removeElements([e]))}return!a}));o.length&&i({code:n,hideDoms:[],exposeDoms:o})}_withInArea(e){var t,n,s;return f({el:e,ratio:(null==(t=this.initParams)?void 0:t.exposeRatio)||0},{el:null==(n=this.scrollInstance)?void 0:n.scrollContainer,mask:(null==(s=this.initParams)?void 0:s.mask)||[0,0,0,0]})}addEleObId(e){return e.filter((e=>{if(e&&1==e.nodeType){if(!e.getAttribute(y)){const t=p();e.setAttribute(y,t)}return!0}}))}singleBlock(e,t){const n=e.elements,s=(null==e?void 0:e.code)||(null==n?void 0:n.code)||`${p()}_code`,i={code:s,handle:t,once:void 0===e.once||e.once,middleJudge:null==e?void 0:e.middleJudge,elements:"",ids:new Set};let r=this.addEleObId(h(n));if(!r.length)return;const o=this.hasBeenExposeId.get(i.code);if(r=r.filter((e=>{const t=e.getAttribute(y)||"";return!(o&&o.has(t)||this.intersectionIoMap.has(t))})),!r.length)return this.logFn("warn","[basis-expose]: 未查询到元素，请检查元素是否[已曝光｜未创建]");i.elements=u(n),this.singleBlockObMap.has(s)||this.singleBlockObMap.set(s,Object.assign({},i));const a=r.map((e=>null==e?void 0:e.getAttribute(y))).filter((e=>!!e)),l=this.singleBlockObMap.get(s)||{};a.forEach((e=>{l.ids.add(e)})),this.singleBlockObMap.set(s,l),this.addToIntersectionOb(r,Object.assign({},i,{ids:null}))}multiBlock(e,t){const n=e.section;if(!n||!n.length)return this.logFn("warn","[basis-expose]: multiBlock - 请传入正确的 section 格式");n.filter((e=>!!e.target)).forEach((n=>{const{container:s,content:i,target:r,code:o}=n,a=o||`${p()}_code`,l=[s,i,r].filter((e=>!!e)).join(" ");this.singleBlock({...e,elements:{code:a,target:l}},t)}))}addToIntersectionOb(e,t){e.forEach((e=>{var n;const s=e.getAttribute(y);if(this.intersectionIoMap.has(s))return;const i=e.getAttribute(E);if(t.code&&i){const e=this.hasBeenExposeId.get(t.code);if(e&&e.has(i))return}this.intersectionIoMap.set(s,t),null==(n=this.scrollInstance)||n.io.observe(e)}))}removeElements(e){var t,n,s;if(!e||!e.length)return this.logFn("warn","[basis-expose]: removeElements - 元素应该给数组类型");for(const i of e){null==(t=this.scrollInstance)||t.io.unobserve(i);const e=i.getAttribute(y),r=this.intersectionIoMap.get(e),o=this.singleBlockObMap.get(r.code);null==(s=null==(n=null==o?void 0:o.ids)?void 0:n.delete)||s.call(n,e),this.intersectionIoMap.delete(e)}}observe(e,t){if(!e)return;const{elements:n,section:s}=e;n||s?(n&&(Array.isArray(n)?n.forEach((n=>{this.singleBlock({...e,elements:n},t)})):this.singleBlock(e,t)),s&&s.length&&this.multiBlock(e,t),this.triggerScroll()):this.logFn("info","[basis-expose]: observe - 缺少元素|选择器")}update(e){if(!e)return this.logFn("warn","[basis-expose]: update - 方法缺少code");e.split(",").forEach((e=>{const t=this.singleBlockObMap.get(e);if(t){const{handle:e}=t;this.singleBlock(t,e)}})),this.triggerScroll()}remove(e){if(!e)return this.logFn("warn","[basis-expose]: remove - 方法缺少code");e.split(",").forEach((e=>{const t=this.singleBlockObMap.get(e);if(t){const n=t.ids;(null==n?void 0:n.size)>0&&n.forEach((e=>{this.intersectionIoMap.delete(e)})),this.singleBlockObMap.delete(e)}this.hasBeenExposeId.delete(e)}))}reset(e){if(!e)return this.logFn("warn","[basis-expose]: reset - 方法缺少code");const t=this.hasBeenExposeId.get(e);t&&(this.hasBeenExposeId.delete(e),[...t].forEach((t=>{const n=h(`[${y}="${t}"]`);if(!n)return;const s=this.singleBlockObMap.get(e);s&&this.singleBlock({...s,elements:{code:e,target:n}},s.handle)})),this.triggerScroll())}resetAll(e){var t;if(this.hasBeenExposeId.size>0){let n=[...this.hasBeenExposeId];e&&("function"==typeof e&&(n=e(n)),"string"==typeof e&&(n=null==(t=null==n?void 0:n.filter)?void 0:t.call(n,(t=>!!t.length&&t[0].startsWith(e))))),n.map((e=>e[0])).forEach((e=>{this.reset(e)}))}}destroy(){var e;null==(e=this.scrollInstance)||e.destroy();const t=l(this.initParams||{});t&&c.del(t)}triggerScroll(){var e;null==(e=this.scrollInstance)||e.triggerScroll()}}var I,C,_,M,S,O,A,k,T,P,D,$,B=n(274061),N=n(665640),j=Object.defineProperty,L=(e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)},R=(e,t,n)=>(L(e,t,"read from private field"),n?n.call(e):t.get(e)),F=(e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)},W=(e,t,n)=>(L(e,t,"access private method"),n);const Q=new Map,H={get(e){return Q.get(e)},has(e){return Q.has(e)},set(e,t){return Q.set(e,t),Q},delete(e){Q.delete(e)}},V=function(e){return e&&/^[12](-\d+){2,4}$/.test(e)},J=function(e){if(!e||V(e))return e;if(e.indexOf("：")>=0)throw new Error("please use english colon.");let[t,n]=e.split(/:/),[s,i,r]=t.split(".");return n=n||"",{evName:s?s.trim():"",pageName:(i||"common").trim(),eId:(r||"").trim(),evSegment:[s,i,r].filter((e=>e&&e.trim())).join("."),modifiers:n.split(".").filter((e=>e&&e.trim()))}};function K(e=0){const t=this;return function(n,...s){const i=()=>{n&&"function"==typeof n&&n.bind(t,...s)()};e?setTimeout(i,e):i()}}function G(){return G.prefix+"_"+ ++G.start}function z(e,t){return t=t||3,"undefined"==typeof window?{}:3==+t?e:{inserted:e.mounted,componentUpdated:e.updated,unbind:e.unmounted}}G.start=G.start||0,G.prefix=Number(Math.random().toString().slice(3,6)+Date.now()).toString(36);const q=e=>{const t=e.value;return!t||!t.id},Y=e=>({set(t,n){return t[e]=n,n},get(t){return t[e]},updateBindValue(e,t){const n=this.get(e);return n?H.set(n,t.value):null},getBindValue(e){return this.get(e)?H.get(this.get(e)):null},clear(t){const n=this.get(t);if(!n)return null;setTimeout((()=>{H.delete(n),delete t[e]}),"PWA"!==("undefined"==typeof window?"":(window.gbCommonInfo||{PLATFORM:""}).PLATFORM||"")?0:1100)}});function U(e,t){const n=J(e);return n&&"object"==typeof n&&t?e+(n.eId?"_":".")+t:e}const X=e=>`${e}_${G()}`;class Z{constructor(){this.subscriber={},this.unSendEvent={},this.has=Object.prototype.hasOwnProperty}publish({target:e=null,daId:t=null,bindData:n=null,sendType:s="event",extraData:i={},parsed:r={}}={}){t&&(this.has.call(this.subscriber,t)?V(t)?this.subscriber[t].sendType.includes(s)&&this.subscriber[t].handler({target:e,extraData:i,bindData:n}):this.subscriber[t]&&this.subscriber[t]({target:e,extraData:i,bindData:n,parsed:r}):this.pushEventInQueue({target:e,daId:t,sendType:s,extraData:i,bindData:n}))}subscribe({daId:e=null,handler:t=null,sendType:n=!1}={}){if(e&&t&&!this.has.call(this.subscriber,e)){if(V(e))return this.subscriber[e]={sendType:n,handler:t},void this.executeEventInQueue({daId:e,handler:t,sendType:n});this.subscriber[e]=t,this.executeEventInQueue({daId:e,handler:t})}}unsubscribe(e){e.forEach((e=>{this.subscriber.hasOwnProperty(e)&&delete this.subscriber[e]}))}pushEventInQueue({target:e=null,daId:t=null,sendType:n="event",bindData:s=null,extraData:i={}}={}){this.has.call(this.unSendEvent,t)||(this.unSendEvent[t]=[]),this.unSendEvent[t].push({target:e,daId:t,sendType:n,bindData:s,extraData:i})}executeEventInQueue({daId:e=null,handler:t=null,sendType:n=[]}={}){if(!this.has.call(this.unSendEvent,e)||this.unSendEvent[e].length<=0)return;let s=this.unSendEvent[e].length;for(;s>0;){let i=this.unSendEvent[e].shift();n.includes(i.sendType)&&t&&t({target:i.target,extraData:i.extraData,bindData:i.bindData}),--s}}}class ee{constructor({controlCenter:e=null}={}){this.controlCenter=e}notify({target:e=null,daId:t=null,sendType:n="event",bindData:s=null,extraData:i={},parsed:r={}}={}){t&&this.controlCenter.publish({target:e,daId:t,sendType:n,extraData:i,bindData:s,parsed:r})}}const te=(e,t)=>e?t.reduce(((t,n)=>(Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]),t)),{}):{},ne=(e,t)=>e?t&&0!==t.length?t.reduce(((e,t)=>(delete e[t],e)),{...e}):e:{},se="undefined"!=typeof window?window:{};se.G_SA_TRACK=se.G_SA_TRACK||{};const ie=()=>{};let re={v2:ie,getMapping:null,legacyAbcd:{addSubscriber:ie,triggerNotice:ie,getExposeInstance:ie,importAbcdCode:ie}};function oe(e){if("undefined"!=typeof window)return se.G_SA_TRACK.__asyncImports?(N.warn("value has been assigned."),!1):(re=se.G_SA_TRACK.__asyncImports=e,!0)}const ae=new Proxy({},{get:(e,t)=>{const n=se.G_SA_TRACK.__asyncImports;return re.hasOwnProperty(t)?(n||re)[t]:null}});let le=!1;const ce={pc:"she_dist",h5:"sh5_dist",pwa:"pwa_dist"};if("undefined"!=typeof window&&"undefined"!=typeof gbCommonInfo){const{PUBLIC_CDN:e="",PLATFORM:t="PC"}=gbCommonInfo;window.__webpack_public_path__=`${e}/${ce[t.toLowerCase()]}/assets/`}"undefined"!=typeof window&&(le=!0);const de=async e=>{if(!e||"string"!=typeof e)return Promise.resolve();let t=e.split("-")||[],n=[];try{let e=t[0]||"0";if(!aTagMap[e])throw new Error(`aTag: ${e} undefined from aTagMap: ${JSON.stringify(aTagMap)}`);n.push(aTagMap[e]);let s=t[1]||"0";if(!bTagMap[`${e}-${s}`])throw new Error(`bTag: ${e}-${s} undefined from bTagMap: ${JSON.stringify(bTagMap)}`);if(n.push(bTagMap[`${e}-${s}`]),"1"===e){let i=t[2]||"0";if(!cTagMap[`${e}-${s}-${i}`])throw new Error(`cTag: ${e}-${s}-${i} undefined from cTabMap: ${JSON.stringify(cTagMap)}`);n.push(cTagMap[`${e}-${s}-${i}`])}return ae.legacyAbcd.importAbcdCode(`${n.join("/")}`)}catch(e){return N.error(e),Promise.resolve()}},ue=Object.create(null);let he=null,pe={subscribeLoadQueue:[],executeSubscribeRequireInQueue(){for(;this.subscribeLoadQueue.length>0;){let{resolve:e,modulecode:t}=this.subscribeLoadQueue.shift();e(de({modulecode:t}))}},require({modCode:e}={}){return e?le?V(e)?de(e):/^(page_|comp_|common)/.test(e)?(async e=>{he||(he=ae.getMapping());try{const t=he[e||"common"];if(ue[e]||!t)return{default:null};const n=[...new Set(Object.values(t))],s=(await Promise.allSettled(n.map((async e=>{try{return(await ae.v2(e)).default}catch(e){return N.error(e),{default:null}}})))).reduce(((e,t)=>"fulfilled"===t.status?{...e,...t.value}:e),{});return ue[e]=s,{default:s}}catch(e){return N.error(e),{default:null}}})(e):Promise.resolve():new Promise(((t,n)=>{this.subscribeLoadQueue.push({resolve:t,reject:n,modCode:e})})):Promise.resolve()}},ge="error";const be={all:0,debug:10,info:20,warning:30,error:40,off:50},fe=new Proxy(N,{get(e,t,n){if("setLevel"===t)return e=>{ge=e};if(!Reflect.has(e,t))return()=>{};const s=Reflect.get(e,t,n);return(...n)=>{if(!(be[t]<be[ge]))return s.apply(e,["[sa-event-center]",...n,"at",Date.now().toString()])}}});fe.setLevel("info");var me={report({sa:e=null}={}){e&&this._sendSa(e)},_sendSa({name:e=null,param:t=null,beacon:n=null,image:s=null,page_param:i=null,page_name:r=null,page_id:o=null}={}){if(!e)return;if("undefined"==typeof sa)return void N.error(`shein-sa is not exist when sending ${[e,JSON.stringify(t)]}`);const a={};r&&(a.page_name=r),o&&(a.page_id=o),fe.debug(e,"start report data"),sa("send",{...a,activity_name:e,activity_param:t||{}},{beacon:n?1:0,image:s?1:0})}};class ve{constructor({controlCenter:e=null}={}){this.controlCenter=e,this.analysis=pe,this.loadedPageNames={}}subscribe({modCode:e=null}={}){return/^(page_|comp_|common)/.test(e=e||"common")&&this.loadedPageNames[e]?Promise.resolve({}):this.analysis.require({modCode:e}).then((({default:t}={})=>{if(!t)return{};if(/^(page_|comp_|common)/.test(e)){if(this.loadedPageNames[e])return;this.loadedPageNames[e]=t}return Object.entries(t).forEach((e=>{const n=e[0];V(n)?this._orgNumMapSub(e[0],e[1],t):this.subNewDirectMap(e[0],e[1])})),t}))}_orgNumMapSub(e,t,n){let{sa:s,ga:i,sendType:r,handler:o}=t;const a=s?JSON.parse(JSON.stringify(s)):void 0,l=i?JSON.parse(JSON.stringify(i)):void 0,c=o?o.bind(n,{sa:a,ga:l,report:me.report.bind(me)}):me.report.bind(me,{sa:a,ga:l});this.controlCenter.subscribe({daId:e,handler:c,sendType:r})}_getMergeParamObj({target:e,extraData:t={},bindData:n={}},s){const i=/^expose_/.test(s.evName)&&s.modifiers.includes("list"),r=(Array.isArray(e)?e:e?[e]:[]).map((e=>e.dataset||null));return{mergeParams:{..."[object Object]"===Object.prototype.toString.call(n)?n:Array.isArray(n)?i?{bindData:n}:n[0]:n,...t},source:{extraData:t,bindData:n,dataset:i?r:r[0]}}}subNewDirectMap(e,t){t=t||(e=>e.extraData),this.controlCenter.subscribe({daId:e,handler:async({target:e,extraData:n,bindData:s,parsed:i})=>{const r=e=>{r._called=!0,me.report({sa:e})},o=this._getMergeParamObj({target:e,extraData:n,bindData:s},i);let a=t({extraData:o.mergeParams,source:o.source,target:e,name:i.evName,parsed:i,report:r},{pick:te,omit:ne,select(e){return te(1===arguments.length?n:arguments[1],e)}});if(void 0===a||!1===a||["number","string"].includes(typeof a))return!1;for(a=a||{};a&&"function"==typeof a.then;)a=await a;const l=Object.prototype.toString.call(a).slice(8,-1);return!!r._called||(r._called||["Object","Null"].includes(l)?void this.reportWithParams(i.evName,a||{}):(N.error(`The return value of track function is ${l}, should be an object.`),!1))}})}directlyReport(e,t){const n=J(e),s=this._getMergeParamObj(t,n);this.reportWithParams(n.evName,s.mergeParams)}reportWithParams(e,t){const n="page_name",s="page_id";let i=e;const r={};let o=(null==t?void 0:t.$options)||{};t&&Object.keys(t).forEach((e=>{e.startsWith("$")&&delete t[e]})),o.sa_v2&&(i=e+"_sem"),o[s]&&(r.page_id=o[s]),o[n]&&(r.page_name=o[n]),Object.keys(r).length&&window.sa("set","setPageData",{...window.SaPageInfo,...r}),me.report({sa:{name:i,param:t||{},...r,image:!!o.send_img,beacon:!!o.send_beacon}})}}class we{constructor({controlCenter:e=null,publisher:t=null,subscriber:n=null}){this.controlCenter=e,this.publisher=t,this.subscriber=n,this.eventAttributeMap={click:"da-event-click",touchstart:"da-event-touchstart",focus:"da-event-focus",blur:"da-event-blur"},this._bindEvent({event:"click",attribute:this.eventAttributeMap.click}),this._bindEvent({event:"touchstart",attribute:this.eventAttributeMap.touchstart}),this._bindEvent({event:"focus",attribute:this.eventAttributeMap.focus,useCapture:!0}),this._bindEvent({event:"blur",attribute:this.eventAttributeMap.blur,useCapture:!0})}_bindEvent({event:e="",attribute:t="",useCapture:n=!1}={}){"undefined"!=typeof document&&document&&document.addEventListener(e,(e=>{var n;if(!t||document===e.target)return;const s=null==(n=e.target)?void 0:n.closest(`[${t}]`);if(!s)return;let i=s.getAttribute(t);this.publisher.notify({daId:i,sendType:"event",target:s})}),n)}bindEventByDaId({event:e="",daId:t=""}={}){document.querySelectorAll(`[${this.eventAttributeMap[e]}="${t}"]`).forEach((n=>{n.addEventListener(e,(e=>{this.publisher.notify({daId:t,sendType:"event",target:e.currentTarget})}))}))}}const ye=new Map,Ee=({code:e})=>{const t=location.pathname;return ye.has(t)?ye.get(t).add(e):ye.set(t,new Set([e])),ye};class xe{constructor({publisher:e,context:t,...n}){this.exposeInst=new x(n),this.publisher=e,this.context=t,this.pendingQueue=[],this.isConsumingPending=!1,this.domInfo={loaded:"loading"!==document.readyState},window.addEventListener("DOMContentLoaded",(()=>{this.domInfo.loaded=!0,this.consumePending()}))}async subscribe({keycode:e="",type:t="",horizontal:n=!1,once:s=!0,middleJudge:i=null,hooks:r={}}){const o=e.split(",");if(!o.length)return;if(!this.checkDocLoad("subscribe",arguments))return;let a=[],l=[];o.forEach((e=>{const s=e.split("`");if(!s[0])return N.warn(`da expose: [${e}] missing subscribe code`);if(s.length<=1)return N.warn(`da expose: subscriber code [${s[0]}] missing expose id`);const i=s[1].split("|").map((e=>`[da-event-expose='${e}']`));"PWA"===gbCommonInfo.PLATFORM&&Ee({code:s[0]}),"list"===t?a.push({code:s[0],container:`[da-expose-code=${s[0]}]`,target:i.join(),averageContent:!1,horizontal:n}):l.push({code:s[0],target:i.map((e=>`[da-expose-code=${s[0]}] ${e}`)).join()})})),(a.length||l.length)&&this.exposeInst.observe({section:a,elements:l,middleJudge:i,once:s},(({exposeDoms:e})=>{let t={};e.forEach((e=>{if(!e)return;const n=e.getAttribute("da-event-expose");let s=t[n]||[];s.push(e),t[n]=s}));for(const e in t){const n=t[e];(null==r?void 0:r.afterExpose)&&"function"==typeof r.afterExpose&&r.afterExpose({targets:n,daId:e}),this.context.triggerNotice({daId:e,sendType:"event",target:n})}}))}async directiveSubscribe(e,t,n){const{getBindInfo:s}=n;this.checkDocLoad("directiveSubscribe",arguments)&&this.exposeInst.observe(t,(({exposeDoms:t})=>{let i={};t.forEach((t=>{var n;if(!t)return;let r=i[e]||{doms:[],binding:[]};r.doms.push(t),r.binding.push((null==(n=s(t))?void 0:n.data)||null),i[e]=r}));for(const e in i){const t=i[e];(null==n?void 0:n.afterExpose)&&"function"==typeof n.afterExpose&&n.afterExpose({targets:t.doms,daId:e}),this.context.triggerNotice({daId:e,sendType:"event",target:t.doms,bindData:t.binding})}}))}reset(e){this.exposeInst.reset(e)}resetAll(e){this.exposeInst.resetAll(e)}triggerScroll(){this.exposeInst.triggerScroll()}update(e){this.exposeInst.update(e)}destroy(){var e;null==(e=this.exposeInst)||e.destroy()}remove(e){var t;null==(t=this.exposeInst)||t.remove(e)}checkDocLoad(e,t){return this.domInfo.loaded?(this.domInfo.loaded&&0===this.pendingQueue.length||this.consumePending(),!0):(this.pendingQueue.push([e,t]),!1)}consumePending(){if(this.isConsumingPending)return!0;this.isConsumingPending=!0,this.pendingQueue.length>0&&(this.pendingQueue.forEach((([e,t])=>{this[e]&&this[e].apply(this,t)})),this.pendingQueue=[])}}const Ie=(e=>{const t=l({});if(t){const e=c.get(t);if(e)return e}const n=new x(e);return t&&c.set(Object.assign(t,{instance:n})),n})();let Ce=null;"undefined"!=typeof window&&(window.windowScrollInstance=Ie,new v);class _e{constructor(e=""){let t=null;t="string"==typeof e?{mode:"runtime"===e?"runtime":"initial"}:e||{mode:"runtime"},this.options=t,this.controlCenter=new Z,this.publisher=new ee({controlCenter:this.controlCenter}),this.subscriber=new ve({controlCenter:this.controlCenter}),this.event=new we({controlCenter:this.controlCenter,publisher:this.publisher,subscriber:this.subscriber}),this.scrollInstance=this.getExposeInstance(),this.__instInfo={mode:t.mode,version:"0.1.8"}}addSubscriber(e){const t=[];if("string"==typeof e)t.push(e);else if(Array.isArray(e))t.push(...e);else if("object"==typeof e){const n=e.modCode||e.modulecode;n&&t.push(n)}const n=t.filter(Boolean).map((e=>V(e)?ae.legacyAbcd?ae.legacyAbcd.addSubscriber({modulecode:e}):null:this.subscriber.subscribe({modCode:e})));return Promise.allSettled(n).then((e=>!0))}addSubscriberObject(e){const t=Object.keys(e),n=[];for(let i of t){const t=e[i];t&&"function"==typeof t?(s=i)&&/^[a-z_]+(?:\.(page_|comp_)[\w-]+(?:\.[\w-]+)?)?$/.test(s)?(n.push(i),this.subscriber.subNewDirectMap(i,t)):fe.warn("only support v2 event, as-like event_name.page_name:modifiers."):fe.warn(`invalid ${i} or handler.`)}var s;return()=>new Promise((e=>{setTimeout((()=>{this.controlCenter.unsubscribe(n),e()}),0)}))}async triggerNotice({target:e,daIdTag:t="",daId:n="",id:s,sendType:i="user",bindData:r=null,extraData:o=null,data:a=null}={},l=0){if(o=o||a||{},!(n=n||s||""))return;const c=Array.prototype.slice.call(arguments);c[0].daId=c[0].id=n,c[0].extraData=c[0].data=o,fe.debug(n,"trigger event");const d=K.call(this,l);if(t&&!e){const s=document.querySelectorAll(`[${t}="${n}"]`);e=s&&s.length>0&&s[0]}if(V(n))return c[0].from_v2_proxy=!0,ae.legacyAbcd.triggerNotice(...c),!0;let u=J(n);const{evName:h,pageName:p,eId:g,modifiers:b,evSegment:f}=u;if(!h)throw new Error("event name should be not empty");if(b.includes("simple"))return this.subscriber.directlyReport(n,{target:e,extraData:o,bindData:r}),!0;const m="runtime"===this.options.mode;if(m&&!this.subscriber.loadedPageNames[p]&&"function"==typeof ae.getMapping&&(fe.debug(n,"pull config begin"),await this.addSubscriber({modCode:p}),fe.debug(n,"pull config end")),!g&&!this.controlCenter.subscriber[f]&&!this.controlCenter.subscriber[h])return m&&N.warn(`${n} does not exist in ${ae.getMapping?"mapping file":"subscriber"} or you should use "simple" modifier.`),!1;d(this.publisher.notify,{target:e,daId:n.split(":")[0],parsed:u,sendType:i,extraData:o,bindData:r})}reportHandler({sa:e=null,sensors:t=null}={}){me.report({sa:e,sensors:t})}bindEvent({event:e="",daId:t=""}={}){e&&t&&this.event.bindEventByDaId({event:e,daId:t})}getExposeInstance(e){return!e&&this.scrollInstance?this.scrollInstance:new xe({publisher:this.publisher,...e,context:this})}}const Me="undefined"==typeof window?{addSubscriber(){},triggerNotice(){},reportHandler(){},bindEvent(){},getExposeInstance(){},__instInfo:{}}:window.daEventCenterV2?window.daEventCenterV2:window.daEventCenterV2=new _e("runtime");class Se{constructor(e){if(F(this,S),F(this,A),F(this,T),F(this,D),((e,t,n)=>{((e,t,n)=>{t in e?j(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n})(e,"symbol"!=typeof t?t+"":t,n)})(this,"intersectionObserver",null),F(this,I,new Set),F(this,C,new Set),F(this,_,{tap:Y(X("__binding_tap")),expose:Y(X("__binding_expose"))}),F(this,M,null),"undefined"==typeof window)return!1;var t,n,s;t=this,n=M,s={daEventCenterInst:e.daEventCenterInst||Me,eId:e.eId||"",observerOptions:{root:null,rootMargin:"200px 200px 200px 200px",threshold:0,...e.observerOptions}},L(t,n,"write to private field"),n.set(t,s),W(this,T,P).call(this)}tap(e,t){if(q(t))return!1;const n=G();H.set(R(this,_).tap.set(e,n),t.value),R(this,I).has(e)||(this.intersectionObserver.observe(e),R(this,I).add(e))}expose(e,t){if(q(t))return!1;const n=G();H.set(R(this,_).expose.set(e,n),t.value),R(this,I).has(e)||(this.intersectionObserver.observe(e),R(this,I).add(e))}get updated(){const{tap:e,expose:t}=R(this,_);return{tap:e.updateBindValue.bind(e),expose:e.updateBindValue.bind(t)}}get unmounted(){const{tap:e,expose:t}=R(this,_);return{tap:t=>{e.clear(t),R(this,I).delete(t)},expose:e=>{t.clear(e),R(this,I).delete(e)}}}}function Oe(e,t){const n="function"==typeof t?t():t||null,{vueVersion:s,eId:i,observerOptions:r,...o}={...n},a=new Se({daEventCenterInst:e,eId:i,observerOptions:r});if("undefined"!=typeof window){const t=e.__instInfo;N.info(`%c[sa-event-center] pkg version: ${t.version}, mode: ${t.mode}, vue-version: ${s}`,"color:green;font-size:14px;font-weight:bold;")}return{tap:z({mounted:a.tap.bind(a),updated:a.updated.tap.bind(a),unmounted:a.unmounted.tap.bind(a)},s),expose:z({mounted:a.expose.bind(a),updated:a.updated.expose.bind(a),unmounted:a.unmounted.expose.bind(a)},s)}}I=new WeakMap,C=new WeakMap,_=new WeakMap,M=new WeakMap,S=new WeakSet,O=async function(e){if(R(this,C).has(e))return!1;R(this,C).add(e),W(this,A,k).call(this,e),await W(this,D,$).call(this,e)},A=new WeakSet,k=function(e){if(!R(this,_).tap.getBindValue(e))return!1;e.addEventListener("click",(()=>{const{id:t,data:n}=R(this,_).tap.getBindValue(e),{daEventCenterInst:s,eId:i}=R(this,M);(V(t)?ae.legacyAbcd.triggerNotice:s.triggerNotice.bind(s))({daId:U(t,i),target:e,bindData:n})}))},T=new WeakSet,P=function(){const e=R(this,M).observerOptions,t=e=>{e.forEach((e=>{e.isIntersecting&&W(this,S,O).call(this,e.target)}))};"function"==typeof window.IntersectionObserver?this.intersectionObserver=new IntersectionObserver(t,e):this.intersectionObserver=new v(t,{scrollContainer:e.root,mask:e.rootMargin,threshold:e.threshold})},D=new WeakSet,$=async function(e){const{expose:t}=R(this,_),n=t.getBindValue(e);if(!n)return!1;const{id:s,container:i,code:r,once:o,prefix:a}=n,l=a||"def-prefix",{daEventCenterInst:c,eId:d}=R(this,M);let u=r||G(),h=null==o||o;l&&(u=`${l}_${u||G()}`),await(0,B.nextTick)(),Ee({code:u});const p="number"==typeof n.delay&&0==+n.delay?c.getExposeInstance({delay:0}):c.getExposeInstance(),g=()=>{p.directiveSubscribe(U(s,d),{elements:{code:u,container:i,target:e},once:h},{getBindInfo:t.getBindValue.bind(t),afterExpose:n.callback||null})};if(n.waitReady&&"true"!==e.dataset.ready){let t=null;const n=n=>{for(const s of n)"attributes"===s.type&&"data-ready"===s.attributeName&&"true"===e.dataset.ready&&(g(),t.disconnect(),t=null)};t=new MutationObserver(n),t.observe(e,{attributes:!0})}else n.delayReady>0?setTimeout(g,n.delayReady):g()};const{tap:Ae,expose:ke}=Oe(Me,(()=>{var e;let t="3";if("undefined"==typeof window)return{};const n=window.gbCommonInfo||{PLATFORM:""};return window.Vue?t=window.Vue.version:n&&n.PLATFORM&&(t=["PWA","H5"].includes(n.PLATFORM)?"2":"3"),t=+((null==(e=t.match(/\d+/))?void 0:e[0])||"3"),{vueVersion:+t,observerOptions:{}}}));function Te(e){e.directive("tap",Ae),e.directive("expose",ke)}}}]);
//# sourceMappingURL=48209-542212a651eec72f.js.map